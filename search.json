[
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "Load libraries",
    "section": "",
    "text": "#| echo: false #| warning: false #| message: false\n\nLoad libraries\nlibrary(quantmod) library(dplyr) library(plotly)\n\n\nDefine current year\ncurrent_year &lt;- 2025\n\n\n1. Get Daily Data\ndf_hist_xts &lt;- getSymbols(“^IXIC”, from = “2008-01-01”, to = “2025-12-31”, src = “yahoo”, auto.assign = FALSE)\n\n\n— STEP A: Calculate the “True” Start Price for each Year —\n\n\nWe need the close of the FIRST trading day to calculate accurate YTD\nyear_start_endpoints &lt;- endpoints(df_hist_xts, on = “years”) # The ‘endpoints’ function returns the LAST index of the period. # To get the FIRST index of the year, we take the previous year’s end + 1. # (We handle the first year manually or just use a grouping trick)\ndf_daily &lt;- data.frame(Date = index(df_hist_xts), coredata(df_hist_xts)) %&gt;% mutate(Year = as.numeric(format(Date, “%Y”)))\n\n\nGroup by Year and take the first available Close price\ndf_start_prices &lt;- df_daily %&gt;% group_by(Year) %&gt;% summarise(Start_Price = first(IXIC.Adjusted))\n\n\n— STEP B: Natural Weeks (1 to 52) —\nweekly_idx &lt;- endpoints(df_hist_xts, on = “weeks”) df_weekly &lt;- df_hist_xts[weekly_idx, ] df_weekly &lt;- data.frame(Date = index(df_weekly), coredata(df_weekly)) %&gt;% mutate( Year = as.numeric(format(Date, “%Y”)), Week = as.numeric(format(Date, “%V”)) # ISO Week ) %&gt;% # Filter for standard weeks only. # We exclude “Week 53” here because we will manually create the perfect one later. # We also exclude the “Week 1” glitch where Dec 31 is labeled as Week 1. filter(Week &lt;= 52, !(format(Date, “%m”) == “12” & Week == 1))\n\n\n— STEP C: The “Special” Week 53 (Year End) —\nyearly_idx &lt;- endpoints(df_hist_xts, on = “years”) df_yearend &lt;- df_hist_xts[yearly_idx, ] df_yearend &lt;- data.frame(Date = index(df_yearend), coredata(df_yearend)) %&gt;% mutate( Year = as.numeric(format(Date, “%Y”)), Week = 53 # Hard-code this as the final bucket )\n\n\n— STEP D: Combine and Calculate —\n\n\nCombine the natural weeks with the special year-end week\ndf_combined &lt;- bind_rows(df_weekly, df_yearend) %&gt;% arrange(Year, Week)\n\n\nJoin with the Start Prices and calculate % Change\ndf_plot &lt;- left_join(df_combined, df_start_prices, by = “Year”) %&gt;% mutate( change_from_year_start = ((IXIC.Adjusted / Start_Price) - 1) * 100 )\n\n\nSplit into historical and current\ndf_hist_plain &lt;- df_plot %&gt;% filter(Year &lt; current_year) df_curr_year &lt;- df_plot %&gt;% filter(Year == current_year)\n\n\nCalculate Average\ndf_avg &lt;- df_hist_plain %&gt;% group_by(Week) %&gt;% summarise(avg_change = mean(change_from_year_start, na.rm = TRUE))\n\n\n— STEP E: Plotting —\np &lt;- plot_ly()\n\n\nHistorical Years\np &lt;- add_trace(p, data = df_hist_plain, x = ~Week, y = ~change_from_year_start, type = ‘scatter’, mode = ‘lines’, split = ~Year, line = list(color = ‘grey’, width = 1), opacity = 0.3, hoverinfo = “text”, text = ~paste(“Year:”, Year, “Week:”, Week, “Change:”, round(change_from_year_start, 1),“%”), showlegend = FALSE)\n\n\nCurrent Year\nif(nrow(df_curr_year) &gt; 0) { p &lt;- add_trace(p, data = df_curr_year, x = ~Week, y = ~change_from_year_start, type = ‘scatter’, mode = ‘lines’, line = list(color = ‘#336699’, width = 3), name = as.character(current_year), hoverinfo = “text”, text = ~paste(“Year:”, Year, “Week:”, Week, “Change:”, round(change_from_year_start, 1),“%”)) }\n\n\nAverage Line\np &lt;- add_trace(p, data = df_avg, x = ~Week, y = ~avg_change, type = ‘scatter’, mode = ‘lines’, line = list(color = ‘darkred’, width = 2, dash = ‘dot’), name = “Avg Return”, hoverinfo = “text”, text = ~paste(“Average”, “Week:”, Week, “Change:”, round(avg_change, 1),“%”))\n\n\nLayout\np &lt;- p %&gt;% layout( xaxis = list( title = “Week (53 = Year End)”, range = c(0.5, 53.5), showgrid = FALSE, tickvals = c(1, 10, 20, 30, 40, 50, 53), ticktext = c(“1”, “10”, “20”, “30”, “40”, “50”, “End”) ), yaxis = list(title = “% Change”, showgrid = TRUE, gridcolor = “#e5e5e5”), showlegend = TRUE, legend = list(orientation = “h”, y = 1.1), plot_bgcolor = “white” ) %&gt;% config(displayModeBar = FALSE)\np"
  }
]